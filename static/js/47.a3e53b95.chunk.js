"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[47],{5853:function(e,n,t){t.d(n,{L:function(){return g}});var r=t(1413),s=t(4925),a=t(2791),o=t(9439),i=t(184),l=(0,a.createContext)();function c(e){var n=(0,a.useState)(!1),t=(0,o.Z)(n,2),r=t[0],s=t[1],c={show:r,setShow:s,toggle:function(){s(!r)}};return(0,i.jsx)(l.Provider,{value:c,children:e.children})}function u(){var e=(0,a.useContext)(l);if("undefined"===typeof e)throw new Error("useDropdown must be used within DropdownProvider");return e}var d=t(2007),h=t.n(d),f=["children"],p=function(e){var n=e.children,t=(0,s.Z)(e,f);return(0,i.jsx)(c,(0,r.Z)((0,r.Z)({},t),{},{children:(0,i.jsx)("div",{className:"relative inline-block w-[260px] z-50",children:n})}))};p.prototype={children:h().any};var g=p,m=function(e){var n=e.onClick,t=u().setShow;return(0,i.jsx)("div",{className:"px-5 py-4 cursor-pointer flex items-center justify-between hover:bg-gray-100 z-50",onClick:function(){n&&n(),t(!1)},children:e.children})},v=["placeholder"],x=function(e){var n=e.placeholder,t=(0,s.Z)(e,v),a=u().onChange;return(0,i.jsx)("div",{className:"p-2",children:(0,i.jsx)("input",(0,r.Z)({type:"text",placeholder:n,className:"p-4 outline-none w-full border border-gray-200 rounded",onChange:a},t))})};x.prototype={placeholder:h().string};var j=x,w=function(e){var n=e.placeholder,t=void 0===n?"":n,r=u(),s=r.show,a=r.toggle;return(0,i.jsxs)("div",{className:"flex items-center justify-between h-[55px] px-5 bg-[#E7ECF3] rounded cursor-pointer font-medium",onClick:a,children:[(0,i.jsx)("span",{children:t}),(0,i.jsx)("span",{children:s?(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]})};w.prototype={placeholder:h().string};var b=w,Z=function(e){var n=e.children,t=u().show;return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsx)("div",{className:"absolute top-full left-0 w-full bg-[#eee] shadow-sm",children:n})})};Z.prototype={children:h().any};var y=Z;g.Option=m,g.Search=j,g.Select=b,g.List=y},8887:function(e,n,t){t.r(n);var r,s=t(4165),a=t(1413),o=t(5861),i=t(9439),l=t(168),c=t(2791),u=t(1775),d=t(5853),h=t(1134),f=t(6444),p=t(333),g=t.n(p),m=t(3585),v=t(2481),x=t(648),j=t(6562),w=t(9808),b=t(577),Z=t(4695),y=t(1724),N=t(6770),k=t.n(N),_=t(5179),C=t(4569),E=t.n(C),I=t(4169),S=t(184);N.Quill.register("modules/imageUploader",_.Z);var D=y.Ry({title:y.Z_().required("Title of the post is a required field!!!"),slug:y.Z_(),image_name:y.Z_().required("Image of the post is a required field!!!")}).required(),L=f.ZP.div(r||(r=(0,l.Z)([""])));n.default=function(){var e,n,t=(0,h.cI)({mode:"onChange",defaultValues:{title:"",slug:"",content:"",status:+m.cf.PENDING,category:{},hot:!1,image:"",user:{}},resolver:(0,Z.X)(D)}),r=t.control,l=t.watch,f=t.setValue,p=t.handleSubmit,y=t.getValues,N=t.reset,_=t.formState,C=_.errors,P=(_.isValid,_.isSubmitting),A=(0,w.a)().userInfo,R=(0,c.useState)([]),O=(0,i.Z)(R,2),T=O[0],q=O[1],J=(0,c.useState)(""),M=(0,i.Z)(J,2),B=M[0],F=M[1],V=(0,c.useState)(""),G=(0,i.Z)(V,2),U=G[0],z=G[1],H=l("status"),W=l("hot");(0,c.useEffect)((function(){var e,n=Object.values(C);n.length>0&&b.Am.error(null===(e=n[0])||void 0===e?void 0:e.message,{pauseOnHover:!1})}),[C]),(0,c.useEffect)((function(){var e;A.email&&function(){(e=e||(0,o.Z)((0,s.Z)().mark((function e(){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,v.IO)((0,v.hJ)(x.db,"users"),(0,v.ar)("email","==",A.email)),e.next=3,(0,v.PL)(n);case 3:e.sent.forEach((function(e){f("user",(0,a.Z)({id:e.id},e.data()))}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()}),[null===A||void 0===A?void 0:A.email]);var Y=(0,j.M)(f,y),Q=Y.image,X=Y.handleResetImage,K=Y.progress,$=Y.handleSelectImage,ee=Y.handleDeleteImage;(0,c.useEffect)((function(){var e;document.title="Blogging App - Add new post",function(){(e=e||(0,o.Z)((0,s.Z)().mark((function e(){var n,t,r,o;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,v.hJ)(x.db,"categories"),t=(0,v.IO)(n,(0,v.ar)("status","==",1)),e.next=4,(0,v.PL)(t);case 4:r=e.sent,o=[],r.forEach((function(e){o.push((0,a.Z)({id:e.id},e.data()))})),q(o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()}),[]);var ne=(0,c.useMemo)((function(){var e;return{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"]],imageUploader:{upload:function(n){return(e=e||(0,o.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("upload: ~ file",n),t=new FormData,console.log("upload: ~ bodyFormData",t),t.append("image",n),e.next=6,E()({method:"post",url:I.f,data:t,headers:{"Content-Type":"multipart/form-data"}});case 6:return r=e.sent,e.abrupt("return",r.data.data.url);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}}),[]);return(0,S.jsxs)(L,{children:[(0,S.jsx)("h1",{className:"dashboard-heading",children:"Write new post"}),(0,S.jsxs)("form",{onSubmit:p((function(n){return(e=e||(0,o.Z)((0,s.Z)().mark((function e(n){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n.slug=g()(n.slug||n.title,{lower:!0}),n.status=+n.status,t=(0,v.hJ)(x.db,"posts"),e.next=6,(0,v.ET)(t,(0,a.Z)((0,a.Z)({},n),{},{image:Q,content:U,createdAt:(0,v.Bt)()}));case 6:b.Am.success("Create new post successfully!!!"),N({title:"",slug:"",content:"",status:+m.cf.PENDING,category:{},hot:!1,image:"",user:{}}),X(),F({}),console.log(n),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),b.Am.error("Create post failed!!!"),console.log(e.t0);case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)})),children:[(0,S.jsxs)("div",{className:"grid grid-cols-2 gap-x-10 mb-2",children:[(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Title"}),(0,S.jsx)(u.II,{control:r,placeholder:"Enter your title",name:"title"})]}),(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Slug"}),(0,S.jsx)(u.II,{control:r,placeholder:"Enter your slug",name:"slug"})]})]}),(0,S.jsxs)("div",{className:"grid grid-cols-2 gap-x-10 mb-2",children:[(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Image"}),(0,S.jsx)(u.Ur,{name:"image",onChange:$,progress:K,image:Q,handleDeleteImage:ee})]}),(0,S.jsxs)("div",{className:"flex flex-col gap-y-8",children:[+(null===A||void 0===A?void 0:A.role)===m.xZ.ADMIN&&(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Status"}),(0,S.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,S.jsx)(u.Y8,{name:"status",control:r,checked:+H===m.cf.APPROVED,value:m.cf.APPROVED,children:"Approved"}),(0,S.jsx)(u.Y8,{name:"status",control:r,checked:+H===m.cf.PENDING,value:m.cf.PENDING,children:"Pending"}),(0,S.jsx)(u.Y8,{name:"status",control:r,checked:+H===m.cf.REJECTED,value:m.cf.REJECTED,children:"Reject"})]})]}),(0,S.jsxs)("div",{className:"flex justify-between items-center",children:[+(null===A||void 0===A?void 0:A.role)===m.xZ.ADMIN&&(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Feature post"}),(0,S.jsx)(u.ZD,{on:!0===W,onClick:function(){return f("hot",!W)}})]}),(0,S.jsx)(u.gN,{children:(0,S.jsxs)("div",{className:"w-[300px]",children:[(0,S.jsx)(u.__,{className:"mb-2 inline-block",children:"Category"}),(0,S.jsxs)(d.L,{children:[(0,S.jsx)(d.L.Select,{placeholder:"".concat((null===B||void 0===B?void 0:B.name)||"Select category")}),(0,S.jsx)(d.L.List,{children:(null===T||void 0===T?void 0:T.length)>0&&T.map((function(e){return(0,S.jsx)(d.L.Option,{onClick:function(){return function(e){return(n=n||(0,o.Z)((0,s.Z)().mark((function e(n){var t,r;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,v.JU)(x.db,"categories",n.id),e.next=3,(0,v.QT)(t);case 3:r=e.sent,f("category",(0,a.Z)({id:r.id},r.data())),F(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(e)},children:e.name},e.id)}))})]})]})})]})]})]}),(0,S.jsxs)(u.gN,{children:[(0,S.jsx)(u.__,{children:"Content"}),(0,S.jsx)("div",{className:"w-full entry-content",children:(0,S.jsx)(k(),{modules:ne,theme:"snow",value:U,onChange:z})})]}),(0,S.jsx)(u.zx,{type:"submit",className:"mx-auto mt-10",isLoading:P,disabled:P,children:"Add new post"})]})]})}},4169:function(e,n,t){t.d(n,{f:function(){return r}});var r="https://api.imgbb.com/1/upload?key=847d3f36b4a2687a994fac840e419dbf"},6562:function(e,n,t){t.d(n,{M:function(){return o}});var r=t(9439),s=t(276),a=t(2791);function o(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=(0,a.useState)(""),l=(0,r.Z)(i,2),c=l[0],u=l[1],d=(0,a.useState)(0),h=(0,r.Z)(d,2),f=h[0],p=h[1],g=(0,s.cF)();if(e&&n){var m=function(){u(null),p(0)};return{image:c,progress:f,setImage:u,handleResetImage:m,handleSelectImage:function(n){var t=n.target.files[0];t&&(e("image_name",t.name),function(e){var n=(0,s.iH)(g,"images/"+e.name),t=(0,s.B0)(n,e);t.on("state_changed",(function(e){var n=e.bytesTransferred/e.totalBytes*100;p(n)}),(function(e){console.log("ERROR: ",e)}),(function(){(0,s.Jt)(t.snapshot.ref).then((function(e){u(e)}))}))}(t))},handleDeleteImage:function(){var e=(0,s.iH)(g,"images/"+t||0);(0,s.oq)(e).then((function(){m(),o&&o()})).catch((function(e){console.log("Can not delete image: ",e)}))}}}}}}]);
//# sourceMappingURL=47.a3e53b95.chunk.js.map