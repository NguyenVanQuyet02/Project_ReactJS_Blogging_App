"use strict";(self.webpackChunkreact_monkey_blogging_boilerplate=self.webpackChunkreact_monkey_blogging_boilerplate||[]).push([[968],{5853:function(e,n,t){t.d(n,{L:function(){return g}});var r=t(1413),a=t(4925),s=t(2791),o=t(9439),i=t(184),l=(0,s.createContext)();function c(e){var n=(0,s.useState)(!1),t=(0,o.Z)(n,2),r=t[0],a=t[1],c={show:r,setShow:a,toggle:function(){a(!r)}};return(0,i.jsx)(l.Provider,{value:c,children:e.children})}function u(){var e=(0,s.useContext)(l);if("undefined"===typeof e)throw new Error("useDropdown must be used within DropdownProvider");return e}var d=t(2007),h=t.n(d),p=["children"],f=function(e){var n=e.children,t=(0,a.Z)(e,p);return(0,i.jsx)(c,(0,r.Z)((0,r.Z)({},t),{},{children:(0,i.jsx)("div",{className:"relative inline-block w-[260px] z-50",children:n})}))};f.prototype={children:h().any};var g=f,m=function(e){var n=e.onClick,t=u().setShow;return(0,i.jsx)("div",{className:"px-5 py-4 cursor-pointer flex items-center justify-between hover:bg-gray-100 z-50",onClick:function(){n&&n(),t(!1)},children:e.children})},v=["placeholder"],x=function(e){var n=e.placeholder,t=(0,a.Z)(e,v),s=u().onChange;return(0,i.jsx)("div",{className:"p-2",children:(0,i.jsx)("input",(0,r.Z)({type:"text",placeholder:n,className:"p-4 outline-none w-full border border-gray-200 rounded",onChange:s},t))})};x.prototype={placeholder:h().string};var j=x,b=function(e){var n=e.placeholder,t=void 0===n?"":n,r=u(),a=r.show,s=r.toggle;return(0,i.jsxs)("div",{className:"flex items-center justify-between h-[55px] px-5 bg-[#E7ECF3] rounded cursor-pointer font-medium",onClick:s,children:[(0,i.jsx)("span",{children:t}),(0,i.jsx)("span",{children:a?(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5 15l7-7 7 7"})}):(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:"2",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})})]})};b.prototype={placeholder:h().string};var w=b,Z=function(e){var n=e.children,t=u().show;return(0,i.jsx)(i.Fragment,{children:t&&(0,i.jsx)("div",{className:"absolute top-full left-0 w-full bg-[#eee] shadow-sm",children:n})})};Z.prototype={children:h().any};var y=Z;g.Option=m,g.Search=j,g.Select=w,g.List=y},1968:function(e,n,t){t.r(n);var r=t(1413),a=t(4165),s=t(5861),o=t(9439),i=t(2791),l=t(1134),c=t(1087),u=t(1775),d=t(5853),h=t(3585),p=t(577),f=t(2481),g=t(648),m=t(6562),v=t(6770),x=t.n(v),j=(t(6009),t(5179)),b=t(4569),w=t.n(b),Z=t(4169),y=t(333),k=t.n(y),N=t(4695),_=t(1724),C=t(9808),E=t(184);v.Quill.register("modules/imageUploader",j.Z);var I=_.Ry({title:_.Z_().required("Title of the post is a required field!!!"),slug:_.Z_(),image_name:_.Z_().required("Image of the post is a required field!!!")}).required();n.default=function(){var e,n,t,v=(0,c.lr)(),j=(0,o.Z)(v,1)[0].get("id"),b=(0,C.a)().userInfo,y=(0,i.useState)({}),_=(0,o.Z)(y,2),S=_[0],D=_[1],L=(0,i.useState)([]),P=(0,o.Z)(L,2),O=P[0],R=P[1],U=(0,i.useState)(""),A=(0,o.Z)(U,2),J=A[0],T=A[1],q=(0,l.cI)({mode:"onChange",resolver:(0,N.X)(I)}),M=q.control,F=q.watch,V=q.reset,B=q.setValue,z=q.getValues,H=q.handleSubmit,Q=q.formState,Y=Q.errors,G=Q.isValid,W=Q.isSubmitting,X=F("hot"),K=F("status");(0,i.useEffect)((function(){var e,n=null===Object||void 0===Object?void 0:Object.values(Y);(null===n||void 0===n?void 0:n.length)>0&&p.Am.error(null===(e=n[0])||void 0===e?void 0:e.message,{pauseOnHover:!1})}),[Y]),(0,i.useEffect)((function(){var e;!function(){(e=e||(0,s.Z)((0,a.Z)().mark((function e(){var n,t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,f.JU)(g.db,"posts",j),e.next=3,(0,f.QT)(n);case 3:(t=e.sent).data()&&(V(t.data()),D((null===(r=t.data())||void 0===r?void 0:r.category)||""),T(t.data().content));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()}),[j,V]);var $=z("image_name"),ee=z("image"),ne=(0,m.M)(B,z,$,(function(){return(e=e||(0,s.Z)((0,a.Z)().mark((function e(){var n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,f.JU)(g.db,"posts",j),e.next=3,(0,f.r7)(n,{image:""});case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)})),te=ne.image,re=ne.progress,ae=ne.setImage,se=ne.handleSelectImage,oe=ne.handleDeleteImage;(0,i.useEffect)((function(){ae(ee)}),[ee,ae]),(0,i.useEffect)((function(){var e;!function(){(e=e||(0,s.Z)((0,a.Z)().mark((function e(){var n,t,s,o;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,f.hJ)(g.db,"categories"),t=(0,f.IO)(n,(0,f.ar)("status","==",+h.bk.APPROVED)),e.next=4,(0,f.PL)(t);case 4:s=e.sent,o=[],s.forEach((function(e){o.push((0,r.Z)({id:e.id},e.data()))})),R(o);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}()}),[]);var ie=(0,i.useMemo)((function(){var e;return{toolbar:[["bold","italic","underline","strike"],["blockquote"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{header:[1,2,3,4,5,6,!1]}],["link","image"]],imageUploader:{upload:function(n){return(e=e||(0,s.Z)((0,a.Z)().mark((function e(n){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("upload: ~ file",n),t=new FormData,console.log("upload: ~ bodyFormData",t),t.append("image",n),e.next=6,w()({method:"post",url:Z.f,data:t,headers:{"Content-Type":"multipart/form-data"}});case 6:return r=e.sent,e.abrupt("return",r.data.data.url);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}}}),[]);return j?(0,E.jsxs)("div",{children:[(0,E.jsx)("h1",{className:"dashboard-heading",children:"Update post"}),(0,E.jsxs)("form",{onSubmit:H((function(e){return(n=n||(0,s.Z)((0,a.Z)().mark((function e(n){var t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G){e.next=2;break}return e.abrupt("return");case 2:return n.status=+n.status,n.slug=k()(n.slug||n.title,{lower:!0}),e.prev=4,t=(0,f.JU)(g.db,"posts",j),e.next=8,(0,f.r7)(t,(0,r.Z)((0,r.Z)({},n),{},{image:te,content:J}));case 8:p.Am.success("Update post successfully!!!"),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(4),p.Am.error("Update post failed!!!");case 14:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)})),children:[(0,E.jsxs)("div",{className:"grid grid-cols-2 gap-x-10 mb-2",children:[(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Title"}),(0,E.jsx)(u.II,{control:M,placeholder:"Enter your title",name:"title"})]}),(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Slug"}),(0,E.jsx)(u.II,{control:M,placeholder:"Enter your slug",name:"slug"})]})]}),(0,E.jsxs)("div",{className:"grid grid-cols-2 gap-x-10 mb-2",children:[(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Image"}),(0,E.jsx)(u.Ur,{name:"image",image:te,progress:re,handleDeleteImage:oe,onChange:se})]}),(0,E.jsxs)("div",{className:"flex flex-col gap-y-8",children:[+(null===b||void 0===b?void 0:b.role)===h.xZ.ADMIN&&(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Status"}),(0,E.jsxs)("div",{className:"flex items-center gap-x-5",children:[(0,E.jsx)(u.Y8,{name:"status",control:M,checked:+K===h.cf.APPROVED,value:h.cf.APPROVED,children:"Approved"}),(0,E.jsx)(u.Y8,{name:"status",control:M,checked:+K===h.cf.PENDING,value:h.cf.PENDING,children:"Pending"}),(0,E.jsx)(u.Y8,{name:"status",control:M,checked:+K===h.cf.REJECTED,value:h.cf.REJECTED,children:"Reject"})]})]}),(0,E.jsxs)("div",{className:"flex justify-between items-center",children:[+(null===b||void 0===b?void 0:b.role)===h.xZ.ADMIN&&(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Feature post"}),(0,E.jsx)(u.ZD,{on:!0===X,onClick:function(){return B("hot",!X)}})]}),(0,E.jsx)(u.gN,{children:(0,E.jsxs)("div",{className:"w-[300px]",children:[(0,E.jsx)(u.__,{className:"mb-2 inline-block",children:"Category"}),(0,E.jsxs)(d.L,{children:[(0,E.jsx)(d.L.Select,{placeholder:"".concat((null===S||void 0===S?void 0:S.name)||"Select category")}),(0,E.jsx)(d.L.List,{children:(null===O||void 0===O?void 0:O.length)>0&&O.map((function(e){return(0,E.jsx)(d.L.Option,{onClick:function(){return function(e){return(t=t||(0,s.Z)((0,a.Z)().mark((function e(n){var t,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,f.JU)(g.db,"categories",n.id),e.next=3,(0,f.QT)(t);case 3:s=e.sent,B("category",(0,r.Z)({id:s.id},s.data())),D(n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}(e)},children:e.name},e.id)}))})]})]})})]})]})]}),(0,E.jsxs)(u.gN,{children:[(0,E.jsx)(u.__,{children:"Content"}),(0,E.jsx)("div",{className:"w-full entry-content",children:(0,E.jsx)(x(),{modules:ie,theme:"snow",value:J,onChange:T})})]}),(0,E.jsx)(u.zx,{type:"submit",className:"mx-auto mt-10",isLoading:W,disabled:W,children:"Update post"})]})]}):null}},4169:function(e,n,t){t.d(n,{f:function(){return r}});var r="https://api.imgbb.com/1/upload?key=847d3f36b4a2687a994fac840e419dbf"},6562:function(e,n,t){t.d(n,{M:function(){return o}});var r=t(9439),a=t(276),s=t(2791);function o(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=(0,s.useState)(""),l=(0,r.Z)(i,2),c=l[0],u=l[1],d=(0,s.useState)(0),h=(0,r.Z)(d,2),p=h[0],f=h[1],g=(0,a.cF)();if(e&&n){var m=function(){u(null),f(0)};return{image:c,progress:p,setImage:u,handleResetImage:m,handleSelectImage:function(n){var t=n.target.files[0];t&&(e("image_name",t.name),function(e){var n=(0,a.iH)(g,"images/"+e.name),t=(0,a.B0)(n,e);t.on("state_changed",(function(e){var n=e.bytesTransferred/e.totalBytes*100;f(n)}),(function(e){console.log("ERROR: ",e)}),(function(){(0,a.Jt)(t.snapshot.ref).then((function(e){u(e)}))}))}(t))},handleDeleteImage:function(){var e=(0,a.iH)(g,"images/"+t||0);(0,a.oq)(e).then((function(){m(),o&&o()})).catch((function(e){console.log("Can not delete image: ",e)}))}}}}},6009:function(){}}]);
//# sourceMappingURL=968.a1986c3b.chunk.js.map